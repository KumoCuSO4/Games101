240127

旋转矩阵和透视矩阵

model view projection矩阵

### 视图变换（模型视图变换）

根据相机的位置和角度进行变换，让相机转到**以-Z为方向，Y为上的角度，且相机位置为原点**（默认是右手系）。让其他物体进行相同的变换，让相机中看到的结果不变。以下图为参考：

![image-20240127161630107](./计算机图形学.assets/image-20240127161630107.png)

**平移操作**比较容易，直接写成这个形式：

![image-20240127161740163](./计算机图形学.assets/image-20240127161740163.png)

**旋转操作**会难一点直接考虑g到-Z，t到Y，(g×t)到X会比较困难，但是反过来的计算更加简单（下图的R^-1^如果乘以X（1，0，0，0）、Y（0，1，0，0）、-Z（0，0，-1，0）得到的分别是(g×t)、t、g），对反过来的矩阵求一个逆矩阵就是我们需要的旋转变换矩阵。**旋转矩阵是正交矩阵，因此他的逆就是他的转置**。

![image-20240127161826141](./计算机图形学.assets/image-20240127161826141.png)

### 投影变换

正交投影 透视投影（近大远小）

#### 正交投影

**简单理解，并非实际做法：**

![image-20240127165931887](./计算机图形学.assets/image-20240127165931887.png)

因为相机是朝向-Z方向，简单的方式是拿掉Z轴（依然要区分物体的前后），然后缩放到[-1,1]*[-1,1]的矩形中（约定俗成的，为了方便后续计算）。

**实际做法：**

![image-20240127173147151](./计算机图形学.assets/image-20240127173147151.png)

一个空间中的长方体，在X轴的左右lr，在Y轴的下上bt，在Z轴的远近fn，映射到[-1,1]^3^的正则（也叫规范、标准）立方体中。（注意远的Z轴小，近的Z轴大，也就是近大于远，因为是-Z的方向。OpenGL会使用左手系来让他变成远大于近，但也会有X×Y不等于Z的问题，左右手系各有好坏）

变换过程，先平移来移动中心到原点，再对三个轴上的尺寸进行缩放，如下图所示。

![image-20240127174138842](./计算机图形学.assets/image-20240127174138842.png)

#### 透视投影

透视投影将一个四棱锥（frustum）挤压为长方体，然后再用正交投影的方法。

![image-20240127191412891](./计算机图形学.assets/image-20240127191412891.png)

**挤压的过程**：首先我们规定：近平面的每个点不变，远平面每个点的Z不变，远平面的中心点不变（为什么）。任意点(x, y, z)映射到近平面z=-n的点(x', y', z')，那么挤压后的x=x'，y=y'，通过相似三角形知道每个点的X和Y该如何变化。(0>n>z>f)

![image-20240127191657918](./计算机图形学.assets/image-20240127191657918.png)

![image-20240127192225944](./计算机图形学.assets/image-20240127192225944.png)

可知挤压后的点为(nx, ny, ?, z)，不过此时我们只知道x和y如何变化，并不知道z如何变化（z并不是不变的），根据之前的定义近平面点不变，远平面z不变可以用来求出第三行的变化。

240128

![image-20240128141018960](./计算机图形学.assets/image-20240128141018960.png)

![image-20240128141342986](./计算机图形学.assets/image-20240128141342986.png)

对于近平面的点(x, y, n, 1)变化之后等于自身也就是(nx, ny, n^2^, n)，n^2^是与x和y无关的数，所以可以得出上图所示的式子An+B=n^2^。又因为远平面中心点(0, 0, f, 1)在挤压后位置不变，得到上图的第二个式子Af+B=f^2^。

最终解出AB

![image-20240128165333412](./计算机图形学.assets/image-20240128165333412.png)

第三行也就是Az+B = (n+f)*z-nf   0>n>z>f

z'-z = k     f^2^-f>k>n^2^-n>0    z'>z

### 光栅化Rasterization

